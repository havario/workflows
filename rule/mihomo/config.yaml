# Copyright (c) 2025 honeok <i@honeok.com>
#
# Description: This configuration file is used to define custom rules for the Mihomo GUI.
#
# Thanks:
# https://github.com/qichiyuhub/rule
# https://github.com/Kook-9527/Plugin-backup
# https://github.com/zzwsec
#
# SPDX-License-Identifier: GPL-2.0-only

# å…¨å±€é…ç½®
port: 7890                        # HTTPä»£ç†ç«¯å£
socks-port: 7891                  # SOCKS5ä»£ç†ç«¯å£
redir-port: 7892                  # é€æ˜ä»£ç†(redirect)ç«¯å£
mixed-port: 7893                  # æ··åˆä»£ç†ç«¯å£, åŒæ—¶æ”¯æŒHTTPå’ŒSOCKS5åè®®
tproxy-port: 7894                 # TProxy(é€æ˜ä»£ç†)ç«¯å£
allow-lan: true                   # å…è®¸å±€åŸŸç½‘å†…çš„å…¶ä»–è®¾å¤‡è¿æ¥åˆ°mihomoä»£ç†æœåŠ¡
bind-address: "*"                 # ç›‘å¬çš„ç½‘ç»œæ¥å£åœ°å€å…è®¸æ‰€æœ‰
ipv6: false                       # ç¦ç”¨IPv6æ”¯æŒ
unified-delay: true               # å¯ç”¨ç»Ÿä¸€çš„å»¶è¿Ÿæµ‹è¯•æ–¹æ³•
tcp-concurrent: true              # å¯ç”¨TCPå¹¶å‘è¿æ¥
log-level: warning                # æ—¥å¿—è¾“å‡ºçº§åˆ«warning
find-process-mode: 'off'          # ç¦ç”¨åŸºäºè¿›ç¨‹çš„æµé‡åŒ¹é…
# interface-name: en0              # ç»‘å®šç½‘å¡å
global-client-fingerprint: chrome # è®¾ç½®å…¨å±€å®¢æˆ·ç«¯æŒ‡çº¹ä¸ºChromeæµè§ˆå™¨
keep-alive-idle: 600              # è®¾ç½®TCPè¿æ¥çš„ç©ºé—²è¶…æ—¶æ—¶é—´ä¸º600ç§’
keep-alive-interval: 15           # è®¾ç½®TCPä¿æ´»æ¢æµ‹çš„é—´éš”æ—¶é—´ä¸º15ç§’
disable-keep-alive: false         # ä¸ç¦ç”¨TCPä¿æ´»æœºåˆ¶
profile:
  store-selected: true            # å¯ç”¨ä¿å­˜ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©çš„ä»£ç†èŠ‚ç‚¹
  store-fake-ip: true             # å¯ç”¨ç¼“å­˜Fake-IPæ˜ å°„

# DNSæ¨¡å—
dns:
  enable: true                    # å¯ç”¨mihomoçš„DNSæ¨¡å—, æ¥ç®¡ç³»ç»ŸDNSè§£æ
  enhanced-mode: fake-ip          # å¯ç”¨Fake-IPæ¨¡å¼, ä¸ºéç›´è¿åŸŸååˆ†é…è™šæ‹ŸIP (å¦‚28.0.0.1/8èŒƒå›´å†…çš„IP) é¿å…ç›´æ¥æš´éœ²çœŸå®ç›®æ ‡IP
  listen: 0.0.0.0:53
  ipv6: false
  respect-rules: true             # DNSè§£æç»“æœéµå¾ªruleséƒ¨åˆ†çš„ä»£ç†è§„åˆ™ (å¦‚cn_domainèµ°ç›´è¿ google_domainèµ°ä»£ç†)
  fake-ip-range: 28.0.0.1/8       # æŒ‡å®šFake-IPæ¨¡å¼çš„è™šæ‹ŸIPåœ°å€èŒƒå›´
  fake-ip-filter-mode: blacklist  # è®¾ç½®Fake-IPè¿‡æ»¤æ¨¡å¼ä¸ºé»‘åå•æ¨¡å¼, fake-ip-filteråˆ—è¡¨ä¸­çš„åŸŸåä¸ä¼šåˆ†é…Fake-IP
  fake-ip-filter:
    - "rule-set:private_domain,cn_domain,ntp_domain"
    - "*.lan"
    - "+.local"
    - "+.msftconnecttest.com"
    - "+.msftncsi.com"
    - "+.xboxlive.com"
    - "xbox.*.microsoft.com"
    - "+.battlenet.com.cn"
    - "+.battlenet.com"
    - "+.blzstatic.cn"
    - "+.battle.net"
    - "+.srv.nintendo.net"
    - "+.stun.playstation.net"
    - "+.kuwo.cn"
    - "+.migu.cn"
    - "+.market.xiaomi.com"
    - "localhost.ptlogin2.qq.com"
    - "time.*.com"
  default-nameserver:             # æŒ‡å®šåˆå§‹DNSè§£ææœåŠ¡å™¨, ç”¨äºè§£æmihomoè‡ªèº«éœ€è¦çš„åŸŸå(å¦‚è®¢é˜…åœ°å€ã€è§„åˆ™é›†åœ°å€)
    - 223.5.5.5
    - 119.29.29.29
  proxy-server-nameserver:        # ä»£ç†æœåŠ¡å™¨ä½¿ç”¨çš„DNSè§£ææœåŠ¡å™¨
    - https://dns.google/dns-query
    - https://223.5.5.5/dns-query
  nameserver:                     # æŒ‡å®šå¸¸è§„DNSè§£ææœåŠ¡å™¨
    - https://223.5.5.5/dns-query
    - https://doh.pub/dns-query

# æœºåœºè®¢é˜…
proxy-providers:
  Airport:
    url: "æœºåœºé€šç”¨è®¢é˜…"
    type: http
    interval: 86400 # è‡ªåŠ¨æ›´æ–°æ—¶é—´(ç§’)
    health-check: # èŠ‚ç‚¹è‡ªåŠ¨æ£€æµ‹å»¶æ—¶
      enable: true
      url: "http://connectivitycheck.platform.hicloud.com/generate_204"
      interval: 300
    proxy: ç›´è¿ # é€šè¿‡ç›´è¿æ‹‰å–æœºåœºè®¢é˜…, è¯¥åå­—æ˜¯æŒ‡ç­–ç•¥ç»„æˆ–æŸä¸ªä»£ç†èŠ‚ç‚¹çš„åå­—

# èŠ‚ç‚¹ä¿¡æ¯
proxies:
  - name: ç›´è¿
    type: direct
  # ä»£ç†é“¾æµé‡èµ°å‘æœºåˆ¶ ä¸¨ Mihomoæœ¬æœº <-> å‰ç½®èŠ‚ç‚¹ <-> è½åœ°èŠ‚ç‚¹ <-> Internetäº’è”ç½‘
  - name: â›“ï¸ é“¾å¼ä»£ç†
    dialer-proxy: "ğŸ‡¸ğŸ‡¬ ç‹®åŸèŠ‚ç‚¹"
    type: socks5
    server: 1.1.1.1
    port: 1080
    username: "12345"
    password: "12345"

# å‡ºç«™ç­–ç•¥
proxy-groups:
  - {name: ğŸš€ é»˜è®¤ä»£ç†, type: select, proxies: [â›“ï¸ é“¾å¼ä»£ç†, ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹, ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, ğŸ‡¸ğŸ‡¬ ç‹®åŸèŠ‚ç‚¹, ğŸ‡²ğŸ‡¾ é©¬æ¥è¥¿äºšèŠ‚ç‚¹, ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹, ğŸ‡³ğŸ‡± è·å…°èŠ‚ç‚¹, ğŸŒ å…¨éƒ¨èŠ‚ç‚¹]}
  - {name: ğŸ“¹ YouTube, type: select, proxies: [â›“ï¸ é“¾å¼ä»£ç†, ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹, ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, ğŸ‡¸ğŸ‡¬ ç‹®åŸèŠ‚ç‚¹, ğŸ‡²ğŸ‡¾ é©¬æ¥è¥¿äºšèŠ‚ç‚¹, ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹, ğŸ‡³ğŸ‡± è·å…°èŠ‚ç‚¹, ğŸŒ å…¨éƒ¨èŠ‚ç‚¹]}
  - {name: ğŸ€ Google, type: select, proxies: [â›“ï¸ é“¾å¼ä»£ç†, ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹, ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, ğŸ‡¸ğŸ‡¬ ç‹®åŸèŠ‚ç‚¹, ğŸ‡²ğŸ‡¾ é©¬æ¥è¥¿äºšèŠ‚ç‚¹, ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹, ğŸ‡³ğŸ‡± è·å…°èŠ‚ç‚¹, ğŸŒ å…¨éƒ¨èŠ‚ç‚¹]}
  - {name: ğŸ¤– AI, type: select, proxies: [â›“ï¸ é“¾å¼ä»£ç†, ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, ğŸ‡¸ğŸ‡¬ ç‹®åŸèŠ‚ç‚¹, ğŸ‡²ğŸ‡¾ é©¬æ¥è¥¿äºšèŠ‚ç‚¹, ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹, ğŸ‡³ğŸ‡± è·å…°èŠ‚ç‚¹, ğŸŒ å…¨éƒ¨èŠ‚ç‚¹]}
  - {name: ğŸ‘¨ğŸ¿â€ğŸ’» GitHub, type: select, proxies: [â›“ï¸ é“¾å¼ä»£ç†, ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹, ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, ğŸ‡¸ğŸ‡¬ ç‹®åŸèŠ‚ç‚¹, ğŸ‡²ğŸ‡¾ é©¬æ¥è¥¿äºšèŠ‚ç‚¹, ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹, ğŸ‡³ğŸ‡± è·å…°èŠ‚ç‚¹, ğŸŒ å…¨éƒ¨èŠ‚ç‚¹]}
  - {name: ğŸ¬ OneDrive, type: select, proxies: [â›“ï¸ é“¾å¼ä»£ç†, ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹, ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, ğŸ‡¸ğŸ‡¬ ç‹®åŸèŠ‚ç‚¹, ğŸ‡²ğŸ‡¾ é©¬æ¥è¥¿äºšèŠ‚ç‚¹, ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹, ğŸ‡³ğŸ‡± è·å…°èŠ‚ç‚¹, ğŸŒ å…¨éƒ¨èŠ‚ç‚¹]}
  - {name: ğŸªŸ Microsoft, type: select, proxies: [â›“ï¸ é“¾å¼ä»£ç†, ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹, ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, ğŸ‡¸ğŸ‡¬ ç‹®åŸèŠ‚ç‚¹, ğŸ‡²ğŸ‡¾ é©¬æ¥è¥¿äºšèŠ‚ç‚¹, ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹, ğŸ‡³ğŸ‡± è·å…°èŠ‚ç‚¹, ğŸŒ å…¨éƒ¨èŠ‚ç‚¹, ç›´è¿]}
  - {name: ğŸµ TikTok, type: select, proxies: [â›“ï¸ é“¾å¼ä»£ç†, ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, ğŸ‡¸ğŸ‡¬ ç‹®åŸèŠ‚ç‚¹, ğŸ‡²ğŸ‡¾ é©¬æ¥è¥¿äºšèŠ‚ç‚¹, ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹, ğŸ‡³ğŸ‡± è·å…°èŠ‚ç‚¹, ğŸŒ å…¨éƒ¨èŠ‚ç‚¹]}
  - {name: ğŸ“² Telegram, type: select, proxies: [â›“ï¸ é“¾å¼ä»£ç†, ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹, ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, ğŸ‡¸ğŸ‡¬ ç‹®åŸèŠ‚ç‚¹, ğŸ‡²ğŸ‡¾ é©¬æ¥è¥¿äºšèŠ‚ç‚¹, ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹, ğŸ‡³ğŸ‡± è·å…°èŠ‚ç‚¹, ğŸŒ å…¨éƒ¨èŠ‚ç‚¹]}
  - {name: ğŸ¥ NETFLIX, type: select, proxies: [â›“ï¸ é“¾å¼ä»£ç†, ğŸ‡¸ğŸ‡¬ ç‹®åŸèŠ‚ç‚¹, ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹, ğŸ‡³ğŸ‡± è·å…°èŠ‚ç‚¹, ğŸŒ å…¨éƒ¨èŠ‚ç‚¹]}
  - {name: âœˆï¸ Speedtest, type: select, proxies: [â›“ï¸ é“¾å¼ä»£ç†, ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹, ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, ğŸ‡¸ğŸ‡¬ ç‹®åŸèŠ‚ç‚¹, ğŸ‡²ğŸ‡¾ é©¬æ¥è¥¿äºšèŠ‚ç‚¹, ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹, ğŸ‡³ğŸ‡± è·å…°èŠ‚ç‚¹, ğŸŒ å…¨éƒ¨èŠ‚ç‚¹, ç›´è¿]}
  - {name: ğŸ’¶ PayPal, type: select, proxies: [â›“ï¸ é“¾å¼ä»£ç†, ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹, ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, ğŸ‡¸ğŸ‡¬ ç‹®åŸèŠ‚ç‚¹, ğŸ‡²ğŸ‡¾ é©¬æ¥è¥¿äºšèŠ‚ç‚¹, ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹, ğŸ‡³ğŸ‡± è·å…°èŠ‚ç‚¹, ğŸŒ å…¨éƒ¨èŠ‚ç‚¹, ç›´è¿]}
  - {name: ğŸ Apple, type: select, proxies: [ç›´è¿, ğŸš€ é»˜è®¤ä»£ç†]}
  - {name: ğŸ¯ ç›´è¿, type: select, proxies: [ç›´è¿]}
  - {name: ğŸŸ æ¼ç½‘ä¹‹é±¼, type: select, proxies: [â›“ï¸ é“¾å¼ä»£ç†, ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹, ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, ğŸ‡¸ğŸ‡¬ ç‹®åŸèŠ‚ç‚¹, ğŸ‡²ğŸ‡¾ é©¬æ¥è¥¿äºšèŠ‚ç‚¹, ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹, ğŸ‡³ğŸ‡± è·å…°èŠ‚ç‚¹, ğŸŒ å…¨éƒ¨èŠ‚ç‚¹, ç›´è¿]}
  - {name: ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹, type: select, include-all: true, filter: "(?i)æ¸¯|hk|hongkong|hong kong"}
  - {name: ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹, type: select, include-all: true, filter: "(?i)æ—¥|jp|japan"}
  - {name: ğŸ‡¸ğŸ‡¬ ç‹®åŸèŠ‚ç‚¹, type: select, include-all: true, filter: "(?i)æ–°åŠ å¡|å¡|ç‹®åŸ|SG|Singapore"}
  - {name: ğŸ‡²ğŸ‡¾ é©¬æ¥è¥¿äºšèŠ‚ç‚¹, type: select, include-all: true, filter: "(?i)é©¬æ¥|my|mys|malay|malaysia"}
  - {name: ğŸ‡ºğŸ‡² ç¾å›½èŠ‚ç‚¹, type: select, include-all: true, filter: "(?i)ç¾|us|unitedstates|united states"}
  - {name: ğŸ‡³ğŸ‡± è·å…°èŠ‚ç‚¹, type: select, include-all: true, filter: "(?i)è·å…°|nl|netherlands"}
  - {name: ğŸŒ å…¨éƒ¨èŠ‚ç‚¹, type: select, include-all: true}

# è§„åˆ™åŒ¹é…
rules:
  - DOMAIN-SUFFIX,gitlab.com,ğŸš€ é»˜è®¤ä»£ç†
  - IP-CIDR,10.0.0.0/8,ç›´è¿
  - IP-CIDR,172.16.0.0/12,ç›´è¿
  - IP-CIDR,192.168.0.0/16,ç›´è¿
  - RULE-SET,private_domain,ç›´è¿
  - RULE-SET,apple_domain,ğŸ Apple
  - RULE-SET,proxylite,ğŸš€ é»˜è®¤ä»£ç†
  - RULE-SET,ai,ğŸ¤– AI
  - RULE-SET,github_domain,ğŸ‘¨ğŸ¿â€ğŸ’» GitHub
  - RULE-SET,youtube_domain,ğŸ“¹ YouTube
  - RULE-SET,google_domain,ğŸ€ Google
  - RULE-SET,onedrive_domain,ğŸ¬ OneDrive
  - RULE-SET,microsoft_domain,ğŸªŸ Microsoft
  - RULE-SET,tiktok_domain,ğŸµ TikTok
  - RULE-SET,speedtest_domain,âœˆï¸ Speedtest
  - RULE-SET,telegram_domain,ğŸ“² Telegram
  - RULE-SET,netflix_domain,ğŸ¥ NETFLIX
  - RULE-SET,paypal_domain,ğŸ’¶ PayPal
  - RULE-SET,gfw_domain,ğŸš€ é»˜è®¤ä»£ç†
  - RULE-SET,geolocation-!cn,ğŸš€ é»˜è®¤ä»£ç†
  - RULE-SET,google_ip,ğŸ€ Google,no-resolve
  - RULE-SET,netflix_ip,ğŸ¥ NETFLIX,no-resolve
  - RULE-SET,telegram_ip,ğŸ“² Telegram,no-resolve
  - RULE-SET,cn_ip,ğŸ¯ ç›´è¿
  - RULE-SET,cn_domain,ğŸ¯ ç›´è¿
  - RULE-SET,ntp_domain,ğŸ¯ ç›´è¿
  - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼

# è§„åˆ™é›†
# https://github.com/MetaCubeX/meta-rules-dat
rule-anchor:
  ip: &ip {type: http, interval: 86400, behavior: ipcidr, format: mrs}
  domain: &domain {type: http, interval: 86400, behavior: domain, format: mrs}
  class: &class {type: http, interval: 86400, behavior: classical, format: text}

rule-providers: 
  private_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/private.mrs"}
  ai: { <<: *domain, url: "https://github.com/MetaCubeX/meta-rules-dat/raw/meta/geo/geosite/category-ai-!cn.mrs" }
  youtube_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/youtube.mrs"}
  google_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/google.mrs"}
  github_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/github.mrs"}
  telegram_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/telegram.mrs"}
  netflix_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/netflix.mrs"}
  paypal_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/paypal.mrs"}
  onedrive_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/onedrive.mrs"}
  microsoft_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/microsoft.mrs"}
  apple_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/apple-cn.mrs"}
  speedtest_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/ookla-speedtest.mrs"}
  tiktok_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/tiktok.mrs"}
  gfw_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/gfw.mrs"}
  geolocation-!cn: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/geolocation-!cn.mrs"}
  cn_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/cn.mrs"}
  ntp_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/category-ntp.mrs"}

  cn_ip: { <<: *ip, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/cn.mrs"}
  google_ip: { <<: *ip, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/google.mrs"}
  telegram_ip: { <<: *ip, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/telegram.mrs"}
  netflix_ip: { <<: *ip, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/netflix.mrs"}